#include "OOOUnitTestDefines.h"
#include "OOOSimplePaste.h"
#include "OOOQuote.h"
#include "OOOForEach.h"

#define TEST_RESULT_2_ARGS	\
	"FUNCTION_DECLARE apple; FUNCTION_DECLARE banana; " \
	"FIELD_DECLARE foo; FIELD_DECLARE bar; " \
	"FIELD_IMPLEMENT foo; FIELD_IMPLEMENT bar; " \
	"FUNCTION_IMPLEMENT apple; FUNCTION_IMPLEMENT banana;"

#define TEST_RESULT_VAR_ARGS	\
	"FUNCTION_DECLARE apple; FUNCTION_DECLARE banana; FUNCTION_DECLARE pear; " \
	"FIELD_DECLARE foo; FIELD_DECLARE bar; " \
	"FIELD_IMPLEMENT foo; FIELD_IMPLEMENT bar; " \
	"FUNCTION_IMPLEMENT apple; FUNCTION_IMPLEMENT banana; FUNCTION_IMPLEMENT pear;"

#define TEST_RESULT_3_LISTS	\
	"FUNCTION_DECLARE apple; FUNCTION_DECLARE banana; FUNCTION_DECLARE pear; " \
	"INTERFACE_IMPLEMENT hello; INTERFACE_IMPLEMENT goodbye; " \
	"FIELD_DECLARE foo; FIELD_DECLARE bar; " \
	"FIELD_IMPLEMENT foo; FIELD_IMPLEMENT bar; " \
	"FUNCTION_IMPLEMENT apple; FUNCTION_IMPLEMENT banana; FUNCTION_IMPLEMENT pear;"

#define TEST_RESULT_EMPTY_LIST	\
	"FUNCTION_DECLARE apple; FUNCTION_DECLARE banana; FUNCTION_DECLARE pear; " \
	"INTERFACE_IMPLEMENT hello; INTERFACE_IMPLEMENT goodbye; " \
	"" \
	"" \
	"FUNCTION_IMPLEMENT apple; FUNCTION_IMPLEMENT banana; FUNCTION_IMPLEMENT pear;"

#define _COUNTPaste(ARG1,ARG2) ARG1##ARG2
#define COUNTPaste(ARG1,ARG2) _COUNTPaste(ARG1,ARG2)

#define COUNT4_0(ARG, ARGS...) COUNTPaste(COUNT5_, OOOIsEmpty(ARGS))(ARGS)
#define COUNT4_1(ARGS...) 4
#define COUNT3_0(ARG, ARGS...) COUNTPaste(COUNT4_, OOOIsEmpty(ARGS))(ARGS)
#define COUNT3_1(ARGS...) 3
#define COUNT2_0(ARG, ARGS...) COUNTPaste(COUNT3_, OOOIsEmpty(ARGS))(ARGS)
#define COUNT2_1(ARGS...) 2
#define COUNT1_0(ARG, ARGS...) COUNTPaste(COUNT2_, OOOIsEmpty(ARGS))(ARGS)
#define COUNT1_1(ARGS...) 1
#define COUNT0_0(ARG, ARGS...) COUNTPaste(COUNT1_, OOOIsEmpty(ARGS))(ARGS)
#define COUNT0_1(ARGS...) 0
#define COUNT(ARGS...) COUNTPaste(COUNT0_, OOOIsEmpty(ARGS))(ARGS)

#define REMAINDER_4(ARG0, ARG1, ARG2, ARG3, ARGS...) ARGS
#define REMAINDER_3(ARG0, ARG1, ARG2, ARGS...) ARGS
#define REMAINDER_2(ARG0, ARG1, ARGS...) ARGS
#define REMAINDER_1(ARG0, ARGS...) ARGS
#define REMAINDER_0(ARGS...) ARGS
#define _REMAINDER(COUNT, ARGS...) REMAINDER_##COUNT(ARGS)
#define REMAINDER(COUNT, ARGS...) _REMAINDER(COUNT, ARGS)

#define SHIFT_4(ARG0, ARG1, ARG2, ARG3, ARGS...) ARG0, ARG1, ARG2, ARG3
#define SHIFT_3(ARG0, ARG1, ARG2, ARGS...) ARG0, ARG1, ARG2
#define SHIFT_2(ARG0, ARG1, ARGS...) ARG0, ARG1
#define SHIFT_1(ARG0, ARGS...) ARG0
#define SHIFT_0(ARGS...)
#define _SHIFT(COUNT, ARGS...) SHIFT_##COUNT(ARGS)
#define SHIFT(COUNT, ARGS...) _SHIFT(COUNT, ARGS)

#define FUNCTION_DECLARE(FIRST, LAST, ITERATION, FUNCTION, REMAINDER) \
	FUNCTION_DECLARE FUNCTION; REMAINDER
#define FUNCTIONS_DECLARE(ARGS...) \
	OOOForEach(FUNCTION_DECLARE, ARGS)
#define FUNCTION_IMPLEMENT(FIRST, LAST, ITERATION, FUNCTION, REMAINDER) \
	FUNCTION_IMPLEMENT FUNCTION; REMAINDER
#define FUNCTIONS_IMPLEMENT(ARGS...) \
	OOOForEach(FUNCTION_IMPLEMENT, ARGS)
#define FIELD_DECLARE(FIRST, LAST, ITERATION, FIELD, REMAINDER) \
	FIELD_DECLARE FIELD; REMAINDER
#define FIELDS_DECLARE(ARGS...) \
	OOOForEach(FIELD_DECLARE, ARGS)
#define FIELD_IMPLEMENT(FIRST, LAST, ITERATION, FIELD, REMAINDER) \
	FIELD_IMPLEMENT FIELD; REMAINDER
#define FIELDS_IMPLEMENT(ARGS...) \
	OOOForEach(FIELD_IMPLEMENT, ARGS)
#define INTERFACE_IMPLEMENT(FIRST, LAST, ITERATION, INTERFACE, REMAINDER) \
	INTERFACE_IMPLEMENT INTERFACE; REMAINDER
#define INTERFACES_IMPLEMENT(ARGS...) \
	OOOForEach(INTERFACE_IMPLEMENT, ARGS)
#define CLASS(ARGS...) \
	FUNCTIONS_DECLARE(SHIFT(ARGS)) \
	FIELDS_DECLARE(SHIFT(REMAINDER(ARGS))) \
	FIELDS_IMPLEMENT(SHIFT(REMAINDER(ARGS))) \
	FUNCTIONS_IMPLEMENT(SHIFT(ARGS))
#define CLASS2(ARGS...) \
	FUNCTIONS_DECLARE(SHIFT(ARGS)) \
	INTERFACES_IMPLEMENT(SHIFT(REMAINDER(REMAINDER(ARGS)))) \
	FIELDS_DECLARE(SHIFT(REMAINDER(ARGS))) \
	FIELDS_IMPLEMENT(SHIFT(REMAINDER(ARGS))) \
	FUNCTIONS_IMPLEMENT(SHIFT(ARGS))
#define VAR_LIST(ARGS...) COUNT(ARGS), ARGS
#define FUNCTIONS(ARGS...) VAR_LIST(ARGS)
#define FIELDS(ARGS...) VAR_LIST(ARGS)
#define INTERFACES(ARGS...) VAR_LIST(ARGS)

OOOTest(OOOMultiVarArg)
{
	char * szTest;

	// should handle 2 functions and 2 fields
	szTest = OOOQuote(CLASS(FUNCTIONS(apple, banana), FIELDS(foo, bar)));
	if (O_strcmp(TEST_RESULT_2_ARGS, szTest) != 0)
	{
		OOOError("expected: %s\nReceived: %s", TEST_RESULT_2_ARGS, szTest);
	}

	// should handle 3 functions and 2 fields
	szTest = OOOQuote(CLASS(FUNCTIONS(apple, banana, pear), FIELDS(foo, bar)));
	if (O_strcmp(TEST_RESULT_VAR_ARGS, szTest) != 0)
	{
		OOOError("expected: %s\nReceived: %s", TEST_RESULT_VAR_ARGS, szTest);
	}

	// should handle 3 lists
	szTest = OOOQuote(CLASS2(FUNCTIONS(apple, banana, pear), FIELDS(foo, bar), INTERFACES(hello, goodbye)));
	if (O_strcmp(TEST_RESULT_3_LISTS, szTest) != 0)
	{
		OOOError("expected: %s\nReceived: %s", TEST_RESULT_3_LISTS, szTest);
	}

	// should handle an empty lists
	szTest = OOOQuote(CLASS2(FUNCTIONS(apple, banana, pear), FIELDS(), INTERFACES(hello, goodbye)));
	if (O_strcmp(TEST_RESULT_EMPTY_LIST, szTest) != 0)
	{
		OOOError("expected: %s\nReceived: %s", TEST_RESULT_EMPTY_LIST, szTest);
	}
}
